---
layout: default
---

<article class="post-content">
	  <h1>{{ page.title }}</h1>
	    <p class="post-meta">{{ page.date | date: "%B %d, %Y" }}</p>
	      {{ content }}
</article>

<script>
// use 'load' instead of 'DOMContentLoaded' to ensure images/fonts 
// are loaded so vertical positions are accurate.
window.addEventListener('load', function() {
	// 1. TOC Logic
	const toc = document.getElementById('toc');
	if (toc) {
		const headers = document.querySelectorAll('.post-content h2, .post-content h3');
		headers.forEach(header => {
			if (!header.id) header.id = header.innerText.toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-]+/g, '');
			const link = document.createElement('a');
			link.href = '#' + header.id;
			link.innerText = header.innerText;
			link.classList.add('toc-link');
			link.dataset.target = header.id;
			if (header.tagName === 'H3') {
				link.style.paddingLeft = '1.0rem';
				link.style.fontSize = '1.0rem';
			 }
			toc.appendChild(link);
		});

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					document.querySelectorAll('.toc-link').forEach(l => l.classList.remove('active'));
					const activeLink = document.querySelector(`.toc-link[data-target="${entry.target.id}"]`);
					if (activeLink) activeLink.classList.add('active');
				}
			 });
		}, { rootMargin: '0px 0px -80% 0px' });
		headers.forEach(header => observer.observe(header));
	}

	 // 2. MARGIN NOTE TELEPORTER
	 const rightSidebar = document.querySelector('.sidebar-right .sidebar-inner');
	 const notes = document.querySelectorAll('.margin-note-source');

	if (rightSidebar && notes.length > 0) {
		notes.forEach(source => {
			const note = document.createElement('div');
			note.classList.add('margin-note');
			note.innerHTML = source.innerHTML;
			
			const sourceRect = source.getBoundingClientRect();
			const sidebarRect = rightSidebar.getBoundingClientRect();
			
			// calculate offset relative to the sidebar container
			const relativeTop = sourceRect.top - sidebarRect.top + 50;
			
			note.style.top = `${relativeTop}px`;
			rightSidebar.appendChild(note);
		});
	}
});
</script>
